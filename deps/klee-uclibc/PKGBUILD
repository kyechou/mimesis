pkgname=klee-uclibc
pkgver=1.2
pkgrel=1
epoch=
pkgdesc="KLEE's version of uClibc"
arch=('x86_64')
url="https://klee.github.io/"
license=('LGPL')
groups=()
depends=('cxx-common=0.0.14')
makedepends=('python' 'wget')
checkdepends=()
optdepends=()
provides=()
conflicts=()
replaces=()
backup=()
options=()
install=
changelog=
source=("https://github.com/klee/klee-uclibc/archive/klee_uclibc_v$pkgver.tar.gz")
noextract=()
sha256sums=('6e983da7aa04db9bc93506d8e9c3208ed79782f72152d6e543e7dcbe5a517745')
validpgpkeys=()

prepare() {
    export TRAILOFBITS_LIBRARIES="/opt/cxx-common/libraries"
    export PATH="${TRAILOFBITS_LIBRARIES}/cmake/bin:${TRAILOFBITS_LIBRARIES}/llvm/bin:${PATH}"

    cd "$srcdir/$pkgname-klee_uclibc_v$pkgver"
    DEVEL_PREFIX="/usr/share/klee-uclibc/" ./configure --make-llvm-lib --with-cc="${TRAILOFBITS_LIBRARIES}/llvm/bin/clang"
    sed -i 's|DEVEL_PREFIX="[^"]*"|DEVEL_PREFIX="/usr/share/klee-uclibc/usr"|' .config
    sed -i 's|RUNTIME_PREFIX="[^"]*"|RUNTIME_PREFIX="/usr/share/klee-uclibc/usr"|' .config
}

build() {
    cd "$srcdir/$pkgname-klee_uclibc_v$pkgver"
    make
}

package() {
    cd "$srcdir/$pkgname-klee_uclibc_v$pkgver"
    make DESTDIR="$pkgdir" install
}
